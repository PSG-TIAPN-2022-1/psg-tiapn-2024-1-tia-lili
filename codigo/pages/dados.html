<!DOCTYPE html>
<html lang="pt_br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tia Lili Marmitex</title>

    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/style_dados.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
    <script src="../assets/js/app.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
</head>
<body onload="verif_login()">

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-success text-white">
            <div class="container" id="navbar">
    
                <a class="navbar-brand text-white" href="../index.html"><img src="../assets/img/tia lili.jpg" style="width: 120px;"></a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#conteudoNavbarSuportado" aria-controls="conteudoNavbarSuportado" aria-expanded="false" aria-label="Alterna navegação">
                    <span class="navbar-toggler-icon"></span>
                </button>
    
                <div class="collapse navbar-collapse" id="conteudoNavbarSuportado">
                        
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link text-white" href="../index.html">Cardápio</a>
                        </li>
    
                        <li class="nav-item">
                            <a class="nav-link text-white" href="carrinho.html">Carrinho</a>
                        </li>
    
    
                        
                    </ul>
    
                    <div class="nav-item">
                        <a id="login_verif" class="nav-link  text-white" href="login.html">login</a>
                    </div>
    
                </div>
            </div>
        </nav>
    </header>

    <main class="container">
        <div>
            <hr class="sep-2" />
            <h4 class="display-5 text-center" id="section_especiais">Dados</h4>
            <hr class="sep-2" />
        </div>
        
        <div class="container-fluid px-1 py-5 mx-auto">
            <div class="row d-flex justify-content-center">
                <div class="col-xl-7 col-lg-8 col-md-9 col-11 text-center">
                    <div class="card">
                        <h5 class="text-center mb-4">Preencha os dados para entrega</h5>
                        <form class="form-card" id="deliveryForm" action="dados.html">
                            <hr class="sep-2" />
                            <section id="entrega" class="mb-3 justify-content-between text-left">
                                <div class=" radio-list2 row d-flex flex-row justify-content-space-between">
                                    <div class="radio-item2 col-sm-6 flex-row d-flex">
                                        <input class="mx-4" name="entrega" id="radio1" type="radio">
                                        <label class="d-flex flex-row justify-content-space-between mx-4" for="radio1">
                                            <h6>Entrega</h6> 
                                        </label>
                                    </div>
                                    <div class="radio-item2 col-sm-6 flex-row d-flex">
                                        <input class="mx-4" name="entrega" id="radio2" type="radio" checked>
                                        <label class="d-flex flex-row justify-content-space-between mx-4" for="radio2">
                                            <h6>Retirada</h6> 
                                        </label>
                                    </div>
                                </div>
                            </section>
                            
                            
                            
                            <div id="address-fields">
                                <hr class="sep-2" />
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="cep">CEP</label>
                                        <input type="text" class="form-control" id="cep" name="cep" maxlength="9">
                                        <div id="cepError" class="error-message"></div>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="rua">Rua</label>
                                        <input type="text" class="form-control" id="rua" name="rua">
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label for="numero">Número</label>
                                        <input type="number" class="form-control" id="numero" name="numero">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="bairro">Bairro</label>
                                        <input oninput="preencherTaxa(document.getElementById('bairro').value)" type="text" class="form-control" id="bairro" name="bairro">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label for="complemento">Complemento</label>
                                        <input type="text" class="form-control" id="complemento" name="complemento">
                                    </div>
                                </div>
                                <hr class="sep-2" />
                                <div class="taxa_entrega">
                                    Taxa de entrega: <div style="display: inline;" id="taxa_entrega"></div>
                                </div>
                            </div>

                            <hr class="sep-2" />
                            <section id="pagamento" class="mb-3 justify-content-between text-left">
                                <div class=" radio-list2 row d-flex flex-row justify-content-space-between">
                                    <div class="radio-item2 col-sm-6 flex-row d-flex">
                                        <input class="mx-4" name="pagamento" id="radio3" type="radio">
                                        <label class="d-flex flex-row justify-content-space-between mx-4" for="radio3">
                                            <h6>Pix</h6> 
                                        </label>
                                    </div>
                                    <div class="radio-item2 col-sm-6 flex-row d-flex">
                                        <input class="mx-4" name="pagamento" id="radio4" type="radio">
                                        <label class="d-flex flex-row justify-content-space-between mx-4" for="radio4">
                                            <h6>Cartão</h6> 
                                        </label>
                                    </div>
                                    <div class="radio-item2 col-sm-12 flex-row d-flex">
                                        <input class="mx-4" name="pagamento" id="radio5" type="radio">
                                        <label class="row d-flex flex-row justify-content-space-between mx-4" for="radio5">
                                            <h6 id="h6_pagamento" class="col-md-6">Dinheiro(Troco)</h6> 
                                            <input class="col-md-6" id="input_valor" type="number" placeholder=" R$0,00">
                                        </label>
                                    </div>
                                </div>
                            </section>
                            <div class="row justify-content-end">
                                <button type="submit" class="col-12 primary avancar flex-row" style="--bg-color: #1095F3; --bg-color-hover: #33B7FE; --bg-color-active: #1581E0; --border-color: #1095F3; --border-color-hover: #33B7FE; --border-color-active: #1581E0; --text-color: #FFFFFF; --text-color-hover: #FFFFFF; --text-color-active: #FFFFFF;">
                                    <p>Avançar</p>
                                    <div data-v-0947ae0f="" class="btndata"></div>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
    </main>
    
    

    <footer class="container-fluid justify-content-center text-light bg-dark">
        <div class="row my-5 justify-content-center py-5">
            <div class="col-11">
                <div class="row ">
                    <div class="col-xl-8 col-md-4 col-sm-4 col-12 my-auto mx-auto a"><h3 class="text-muted mb-md-0 mb-5 bold-text">Tia Lili Marmitex.</h3></div>
                    <div class="col-xl-2 col-md-4 col-sm-4 col-12"><h6 class="mb-3 mb-lg-4 bold-text "><b>MENU</b></h6><ul class="list-unstyled"><li>Marmitas</li><li>Bebidas</li><li>Especiais</li><li>Carrinho</li><li>Pedidos</li><li>Login</li></ul></div>
                    <div class="col-xl-2 col-md-4 col-sm-4 col-12"><h6 class="mb-3 mb-lg-4 text-muted bold-text mt-sm-0 mt-5"><b>Endereço</b></h6><p class="mb-1">Rua Anori 175, São Gabriel</p><p>Belo Horizonte - MG</p></div>
                </div>
                <div class="row ">
                    <div class="col-xl-8 col-md-4 col-sm-4 col-auto my-md-0 mt-5 order-sm-1 order-3 align-self-end"><p class="social text-muted mb-0 pb-0 bold-text"> <span class="mx-2"><i class="fa fa-facebook" aria-hidden="true"></i></span> <span class="mx-2"><i class="fa fa-linkedin-square" aria-hidden="true"></i></span> <span class="mx-2"><i class="fa fa-twitter" aria-hidden="true"></i></span> <span class="mx-2"><i class="fa fa-instagram" aria-hidden="true"></i></span></p><small class="rights"><span>&#174;</span> Tia Lili Marmitex All Rights Reserved.</small></div>
                    <div class="col-xl-2 col-md-4 col-sm-4 col-auto order-1 align-self-end "><h6 class="mt-55 mt-2 text-muted bold-text"><b>Contato</b></h6><small> <span><i class="fa fa-envelope" aria-hidden="true"></i></span> <a href="https://api.whatsapp.com/send/?phone=%2B5531971141408&text&type=phone_number&app_absent=0" class="text-light bold-text" target="_blank">+55 31 97114-1408</a></small></div>
                </div>
            </div>
        </div>
    </footer>    

    <!-- Incluindo jQuery e script para consulta de CEP -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>

    

    <script>
        $(document).ready(function() {
            // Função para consultar o CEP via API e preencher os campos de endereço
            function consultaCEP(cep) {
                // Remover caracteres não numéricos
                cep = cep.replace(/\D/g, '');

                // Verificar se o CEP possui 8 dígitos numéricos
                if (cep.length === 8) {
                    // URL da API ViaCEP para consulta
                    var url = 'https://viacep.com.br/ws/' + cep + '/json/';

                    // Fazer requisição GET para a API
                    $.ajax({
                        url: url,
                        dataType: 'json',
                        success: function(data) {
                            if (!data.erro) {
                                // Preencher os campos de endereço
                                $('#rua').val(data.logradouro);
                                $('#bairro').val(data.bairro);
                                // Pode-se adicionar outros campos como cidade e estado se necessário
                                
                            } else {
                                // Caso ocorra algum erro na consulta
                                $('#rua').val('');
                                $('#bairro').val('');
                                alert('CEP não encontrado.');
                            }
                        },
                        error: function() {
                            // Em caso de falha na requisição
                            $('#rua').val('');
                            $('#bairro').val('');
                            alert('Erro ao consultar o CEP. Por favor, tente novamente.');
                        }
                    });
                }
            }

            // Evento para acionar a consulta de CEP ao perder o foco do campo
            $('#cep').blur(function() {
                var cep = $(this).val();
                consultaCEP(cep);
            });

            // Função para preencher os campos de endereço com dados do localStorage
            function populateAddressFields() {
                if(localStorage.getItem('usuario')) {
                    const usuario = JSON.parse(localStorage.getItem('usuario'));

                    // Preenche os campos do formulário com os dados do localStorage
                    document.getElementById('cep').value = usuario.cep || '';
                    document.getElementById('rua').value = usuario.rua || '';
                    document.getElementById('numero').value = usuario.numero || '';
                    document.getElementById('bairro').value = usuario.bairro || '';
                    document.getElementById('complemento').value = usuario.complemento || '';
                    preencherTaxa(document.getElementById('bairro').value)
        
                   
                }
            }

            // Evento para mudança na opção de entrega
            $('input[name="entrega"]').change(function() {
                if ($('#radio1').is(':checked')) {
                    $('#address-fields').show();
                    
                    populateAddressFields(); // Preencher os campos ao selecionar "Entrega"
                } else {
                    $('#address-fields').hide(); // Esconder os campos ao selecionar "Retirada"
                }
            });

            // Inicialização dos campos se a opção inicial for "Entrega"
            if ($('#radio1').is(':checked')) {
                $('#address-fields').show();
                populateAddressFields(); // Preencher os campos ao carregar a página se a opção for "Entrega"
            } else {
                $('#address-fields').hide(); // Esconder os campos se a opção não for "Entrega"
            }
        });
    </script>
    
    <script>
        document.getElementById('deliveryForm').addEventListener('submit', function(event) {
            const pagamentoDinheiro = document.getElementById('radio5').checked;
            const trocoInput = document.getElementById('input_valor');
            const trocoValor = parseFloat(trocoInput.value) || 0;
            const valorMinimo = new URLSearchParams(window.location.search).get('valor');
            const pedido_id = new URLSearchParams(window.location.search).get('pedido');
            

            const pagamentoPix = document.getElementById('radio3').checked;
            const pagamentoCartao = document.getElementById('radio4').checked;
            
            if (pagamentoDinheiro && trocoValor < valorMinimo) {
                event.preventDefault();
                
                alert('Por favor, preencha o campo Troco com um valor igual ou maior do que R$'+valorMinimo+',00.');
                trocoInput.focus();
            } else if(pagamentoPix || pagamentoCartao || pagamentoDinheiro){
                event.preventDefault();
                
                enviar_pedido(valorMinimo, trocoValor, pedido_id);
            } else {
                const pagamento = document.getElementById('pagamento');
                event.preventDefault();
                alert('Selecione algum meio de pagamento!');
                pagamento.focus();
            }


        });
    </script>
    
    

</body>
</html>
